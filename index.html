<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø³ÙˆÙ‚ ØªØ²Ù†ÙŠØª â€” Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø³ÙŠØ·Ø©</title>
  <style>
    :root{--main:#0d6efd;--muted:#666}
    body{font-family:Inter, "Segoe UI", Arial, sans-serif;background:#f5f7fb;color:#111;margin:0;padding:18px;direction:rtl}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
    header h1{margin:0;font-size:20px;color:var(--main)}
    .top-actions{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--main);color:#fff}
    .btn.ghost{background:#fff;border:1px solid #e6e9ee}
    .search input{padding:8px 10px;border-radius:8px;border:1px solid #ddd;min-width:220px}
    main{display:grid;grid-template-columns:320px 1fr;gap:16px}
    .panel{background:#fff;border-radius:10px;padding:12px;border:1px solid #e9eef5;box-shadow:0 6px 18px rgba(13,110,253,0.04)}
    .form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
    label{font-size:13px;color:#333}
    input[type="text"], textarea, select{padding:10px;border-radius:8px;border:1px solid #e6e9ee}
    textarea{min-height:80px;resize:vertical}
    .list{display:flex;flex-direction:column;gap:12px}
    .card{display:flex;gap:10px;align-items:flex-start;border-radius:10px;border:1px solid #f0f3f6;padding:10px;background:#fff}
    .thumb{width:92px;height:72px;background:#eee;border-radius:8px;object-fit:cover}
    .card-body{flex:1}
    .title{font-weight:800;font-size:15px}
    .meta{color:var(--muted);font-size:13px;margin-top:6px}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .small{font-size:13px;padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
    .approve{background:#e6ffef;color:#0f8a47}
    .reject{background:#fff0f0;color:#c62828;border:1px solid #f8c7cc}
    .edit{background:#fff;border:1px solid #cfe3ff;color:#0d6efd}
    .feature{background:linear-gradient(90deg,#ffd166,#ff8a00);color:#fff}
    .wa{background:#25d366;color:#fff}
    .toggle{background:#fff;border:1px solid #eee;color:#333}
    .del{background:#ffeef0;color:#b00020}
    .status-badge{padding:6px 8px;border-radius:8px;background:#f4f6f8;font-weight:700;font-size:13px}
    .featured-pill{background:linear-gradient(90deg,#ffd166,#ff8a00);color:#fff;padding:6px 8px;border-radius:14px;font-weight:700;font-size:12px}
    .center{display:flex;justify-content:center;align-items:center}
    footer{margin-top:16px;color:#666;text-align:center}
    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;justify-content:center;align-items:center;padding:18px;z-index:50}
    .modal{background:#fff;border-radius:10px;padding:16px;max-width:760px;width:100%;box-shadow:0 20px 50px rgba(2,6,23,0.2)}
    @media(max-width:900px){main{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Ø³ÙˆÙ‚ ØªØ²Ù†ÙŠØª â€” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
      <div class="top-actions">
        <div class="search">
          <input id="q" placeholder="Ù‚Ù„Ø¨ Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†ØŒ Ù…Ø«Ø§Ù„: ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ" />
        </div>
        <button class="btn ghost" id="btnClear">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn primary" id="btnNew">Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </header>

    <main>
      <!-- form / admin actions -->
      <aside class="panel">
        <h3 style="margin-top:0">Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
        <div class="form-row">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
          <input id="f_title" placeholder="Ù…Ø«Ø§Ù„: ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ù…Ø§Ù‡Ø± - ØµÙŠØ§Ù†Ø©" />
        </div>
        <div class="form-row">
          <label>Ø§Ù„ÙØ¦Ø©</label>
          <select id="f_cat">
            <option>Ø®Ø¯Ù…Ø§Øª</option><option>Ø£Ø¬Ù‡Ø²Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option><option>Ø¹Ù‚Ø§Ø±Ø§Øª</option><option>Ø³ÙŠØ§Ø±Ø§Øª</option><option>Ø£Ø¹Ù…Ø§Ù„ Ø­Ø±ÙÙŠØ©</option>
          </select>
        </div>
        <div class="form-row">
          <label>Ø§Ù„ÙˆØµÙ</label>
          <textarea id="f_desc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†..."></textarea>
        </div>
        <div class="form-row">
          <label>Ø§Ù„Ø«Ù…Ù† / Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶</label>
          <input id="f_price" placeholder="150 Ø¯Ø±Ù‡Ù… Ø£Ùˆ 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶'" />
        </div>
        <div class="form-row">
          <label>Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ù„Ø¯+Ø±Ù…Ø² Ø¨Ø¯ÙˆÙ† +)</label>
          <input id="f_wa" placeholder="2126XXXXXXXX" />
        </div>
        <div class="form-row">
          <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="f_img" placeholder="https://..." />
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn primary" id="btnPublish">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
          <button class="btn ghost" id="btnFillDemo">ØªØ¹Ø¨Ø¦Ø© Ù…Ø«Ø§Ù„</button>
        </div>

        <hr style="margin:12px 0"/>

        <div>
          <div style="font-weight:800;margin-bottom:6px">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø­Ù„ÙŠØ©</div>
          <div id="stats">0 Ø¥Ø¹Ù„Ø§Ù† Â· 0 Ù…Ù…ÙŠØ² Â· 0 Ù…ÙØ¹Ù„</div>
        </div>
      </aside>

      <!-- ads list -->
      <section>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
            <div style="color:var(--muted);font-size:13px" id="lastSaved">Ø¢Ø®Ø± Ø­ÙØ¸: â€”</div>
          </div>

          <div style="margin-top:12px" id="adsList" class="list"></div>
        </div>

        <footer>Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© Ù„Ù„ØªØ¬Ø±ÙŠØ¨. Ù†Ù‚Ø¯Ø± Ù†Ø±Ø¨Ø· Ù‡Ø§Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Firebase Ø£Ùˆ API Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠÙ…Ø§ Ø¨Ø¹Ø¯.</footer>
      </section>
    </main>
  </div>

  <!-- modal edit -->
  <div class="modal-back" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
      <div class="form-row">
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input id="m_title" />
      </div>
      <div class="form-row">
        <label>Ø§Ù„ÙØ¦Ø©</label>
        <select id="m_cat">
          <option>Ø®Ø¯Ù…Ø§Øª</option><option>Ø£Ø¬Ù‡Ø²Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option><option>Ø¹Ù‚Ø§Ø±Ø§Øª</option><option>Ø³ÙŠØ§Ø±Ø§Øª</option><option>Ø£Ø¹Ù…Ø§Ù„ Ø­Ø±ÙÙŠØ©</option>
        </select>
      </div>
      <div class="form-row">
        <label>Ø§Ù„ÙˆØµÙ</label>
        <textarea id="m_desc"></textarea>
      </div>
      <div class="form-row">
        <label>Ø§Ù„Ø«Ù…Ù†</label>
        <input id="m_price" />
      </div>
      <div class="form-row">
        <label>ÙˆØ§ØªØ³Ø§Ø¨</label>
        <input id="m_wa" />
      </div>
      <div class="form-row">
        <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©</label>
        <input id="m_img" />
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn ghost" id="modalCancel">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn primary" id="modalSave">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      </div>
    </div>
  </div>

  <script>
    // Ø¨Ø³ÙŠØ·Ø©: ØªØ®Ø²ÙŠÙ† ÙÙ€ localStorage ØªØ­Øª Ù…ÙØªØ§Ø­ "tz_ads_v1"
    const STORAGE_KEY = 'tz_ads_v1';
    let ads = [];
    let editId = null;

    // Ø¹Ù†Ø§ØµØ±
    const adsList = document.getElementById('adsList');
    const statsEl = document.getElementById('stats');
    const lastSaved = document.getElementById('lastSaved');
    const qInput = document.getElementById('q');

    // load/save
    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        ads = raw ? JSON.parse(raw) : [];
      } catch(e){ ads = []; }
      render();
    }
    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(ads));
      lastSaved.textContent = 'Ø¢Ø®Ø± Ø­ÙØ¸: ' + new Date().toLocaleString();
    }

    // id generator
    function uid(){ return 'id' + Math.random().toString(36).slice(2,9); }

    // demo data
    function fillDemo(){
      ads.unshift(
        { id: uid(), title: 'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ù…Ø§Ù‡Ø± â€” ØµÙŠØ§Ù†Ø© Ø¹Ø§Ù…Ø©', cat:'Ø®Ø¯Ù…Ø§Øª', desc:'ØªØµÙ„ÙŠØ­ Ø£Ø¹Ø·Ø§Ù„ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ùˆ ØªØ±ÙƒÙŠØ¨ Ù„ÙˆØ­Ø§Øª', price:'150 Ø¯Ø±Ù‡Ù…', wa:'2126XXXXXXXX', img:'https://via.placeholder.com/600x400?text=ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', city:'ØªØ²Ù†ÙŠØª', active:false, approved:false, featured:false, createdAt:Date.now(), rejectedReason:'' },
        { id: uid(), title: 'Ù…ØµÙ…Ù… ÙˆÙŠØ¨ Ø­Ø± â€” Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ³ÙŠÙˆ', cat:'Ø£Ø¬Ù‡Ø²Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', desc:'ØªØµÙ…ÙŠÙ… Ù…ÙˆØ§Ù‚Ø¹ ØªÙØ§Ø¹Ù„ÙŠØ© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', price:'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶', wa:'2126YYYYYYYY', img:'https://via.placeholder.com/600x400?text=ØªØµÙ…ÙŠÙ…+ÙˆÙŠØ¨', city:'ØªØ²Ù†ÙŠØª', active:true, approved:true, featured:true, createdAt:Date.now()-86400000, rejectedReason:'' }
      );
      save(); render();
    }

    // render
    function render() {
      const q = qInput.value.trim().toLowerCase();
      const filtered = ads.filter(a => {
        if (!q) return true;
        return (a.title + ' ' + a.desc + ' ' + a.cat).toLowerCase().includes(q);
      });

      adsList.innerHTML = '';
      if (filtered.length === 0) {
        adsList.innerHTML = '<div class="center" style="padding:24px;color:var(--muted)">Ù…Ø§ÙƒØ§ÙŠÙ†Ø´ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>';
      } else {
        filtered.forEach(a => {
          const el = document.createElement('div');
          el.className = 'card';
          el.innerHTML = `
            <img class="thumb" src="${a.img || 'https://via.placeholder.com/600x400?text=ØµÙˆØ±Ø©'}" alt="">
            <div class="card-body">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
                <div>
                  <div class="title">${escapeHtml(a.title)}</div>
                  <div class="meta">${escapeHtml(a.cat)} Â· ${a.city} Â· ${timeAgo(a.createdAt)}</div>
                </div>
                <div style="text-align:left">
                  ${a.featured ? '<div class="featured-pill">Ù…Ù…ÙŠØ²</div>' : ''}
                  <div style="margin-top:6px" class="status-badge">${a.approved ? (a.active ? 'Ù…ÙØ¹Ù„' : 'Ù…Ø¹ØªÙ…Ø¯ - Ù…ØªÙˆÙ‚Ù') : (a.rejectedReason ? 'Ù…Ø±ÙÙˆØ¶' : 'ØºÙŠØ± Ù…ÙØ¹Ù„')}</div>
                </div>
              </div>
              <div style="margin-top:8px;color:#333">${escapeHtml(a.desc)}</div>
              <div class="controls">
                <button class="small approve" onclick="approve('${a.id}')">âœ” Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</button>
                <button class="small reject" onclick="rejectAd('${a.id}')">âœ– Ø±ÙØ¶</button>
                <button class="small edit" onclick="openEdit('${a.id}')">âœ ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="small feature" onclick="toggleFeature('${a.id}')">â­ ØªÙ…ÙŠÙŠØ²</button>
                <a class="small wa" href="https://wa.me/${a.wa}?text=${encodeURIComponent('Ø³Ù„Ø§Ù…ØŒ Ù…Ù‡ØªÙ… Ø¨Ø®Ø¯Ù…ØªÙƒ Ù…Ù† Ø³ÙˆÙ‚ ØªØ²Ù†ÙŠØª')}" target="_blank">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                <button class="small toggle" onclick="toggleActive('${a.id}')">ğŸ” ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
                <button class="small del" onclick="deleteAd('${a.id}')">ğŸ—‘ Ø­Ø°Ù</button>
              </div>
            </div>
          `;
          adsList.appendChild(el);
        });
      }

      // stats
      const total = ads.length;
      const featured = ads.filter(x => x.featured).length;
      const active = ads.filter(x => x.active).length;
      statsEl.textContent = `${total} Ø¥Ø¹Ù„Ø§Ù† Â· ${featured} Ù…Ù…ÙŠØ² Â· ${active} Ù…ÙØ¹Ù„`;
    }

    // helpers
    function find(id){ return ads.find(a => a.id === id); }
    function indexOf(id){ return ads.findIndex(a => a.id === id); }
    function timeAgo(ts){
      if (!ts) return '';
      const diff = Date.now() - ts;
      const d = Math.floor(diff / 86400000);
      if (d === 0) return 'Ø§Ù„ÙŠÙˆÙ…';
      if (d === 1) return 'Ù…Ù†Ø° ÙŠÙˆÙ…';
      return 'Ù…Ù†Ø° ' + d + ' Ø£ÙŠØ§Ù…';
    }
    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // actions (global functions so buttons inline can call)
    window.approve = function(id){
      const a = find(id);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      if (!confirm('Ø¨ØºÙŠØªÙŠ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) return;
      a.approved = true;
      a.rejectedReason = '';
      save(); render();
      audit('approve', id);
      alert('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.');
    };

    window.rejectAd = function(id){
      const a = find(id);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      const reason = prompt('Ø¹Ù„Ø§Ø´ Ø¨ØºÙŠØª ØªØ±ÙØ¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)');
      if (reason === null) return;
      a.approved = false;
      a.rejectedReason = reason || '';
      save(); render();
      audit('reject', id, { reason });
      alert('ØªÙ… Ø§Ù„Ø±ÙØ¶.');
    };

    window.openEdit = function(id){
      const a = find(id);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      editId = id;
      document.getElementById('m_title').value = a.title;
      document.getElementById('m_cat').value = a.cat;
      document.getElementById('m_desc').value = a.desc;
      document.getElementById('m_price').value = a.price;
      document.getElementById('m_wa').value = a.wa;
      document.getElementById('m_img').value = a.img || '';
      document.getElementById('modal').style.display = 'flex';
    };

    window.toggleFeature = function(id){
      const a = find(id);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      a.featured = !a.featured;
      save(); render();
      audit('feature_toggle', id, { featured: a.featured });
      alert(a.featured ? 'ØªÙ… ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†' : 'ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ²');
    };

    window.toggleActive = function(id){
      const a = find(id);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      a.active = !a.active;
      save(); render();
      audit('toggle_active', id, { active: a.active });
    };

    window.deleteAd = function(id){
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
      const i = indexOf(id);
      if (i === -1) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      ads.splice(i,1);
      save(); render();
      audit('delete', id);
      alert('ØªÙ… Ø§Ù„Ø­Ø°Ù.');
    };

    // publish new
    document.getElementById('btnPublish').addEventListener('click', ()=>{
      const title = document.getElementById('f_title').value.trim();
      const cat = document.getElementById('f_cat').value;
      const desc = document.getElementById('f_desc').value.trim();
      const price = document.getElementById('f_price').value.trim() || 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶';
      const wa = document.getElementById('f_wa').value.trim() || '';
      const img = document.getElementById('f_img').value.trim() || '';
      if (!title) return alert('Ø¹Ù’Ù…Ù‘Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');
      const a = { id: uid(), title, cat, desc, price, wa, img, city:'ØªØ²Ù†ÙŠØª', active:false, approved:false, featured:false, createdAt:Date.now(), rejectedReason:'' };
      ads.unshift(a);
      save(); render();
      audit('create', a.id);
      // clear form
      document.getElementById('f_title').value = '';
      document.getElementById('f_desc').value = '';
      document.getElementById('f_price').value = '';
      document.getElementById('f_wa').value = '';
      document.getElementById('f_img').value = '';
      alert('ØªÙ… Ø§Ù„Ù†Ø´Ø± (Ø®Ø§Øµ Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡)'); 
    });

    // modal actions
    document.getElementById('modalCancel').addEventListener('click', ()=>{ document.getElementById('modal').style.display = 'none'; editId = null; });
    document.getElementById('modalSave').addEventListener('click', ()=>{
      if (!editId) return;
      const a = find(editId);
      if(!a) return alert('Ù…Ø§ Ù„Ù‚ÙŠØªØ´ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      a.title = document.getElementById('m_title').value.trim();
      a.cat = document.getElementById('m_cat').value;
      a.desc = document.getElementById('m_desc').value.trim();
      a.price = document.getElementById('m_price').value.trim();
      a.wa = document.getElementById('m_wa').value.trim();
      a.img = document.getElementById('m_img').value.trim();
      save(); render();
      audit('edit', editId);
      document.getElementById('modal').style.display = 'none'; editId = null;
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');
    });

    // other UI
    document.getElementById('btnNew').addEventListener('click', ()=> { window.scrollTo({top:0,behavior:'smooth'}); document.getElementById('f_title').focus(); });
    document.getElementById('btnClear').addEventListener('click', ()=> {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ØŸ')) return;
      localStorage.removeItem(STORAGE_KEY);
      load();
    });
    document.getElementById('btnFillDemo').addEventListener('click', ()=> { fillDemo(); });

    // search
    qInput.addEventListener('input', ()=> render());

    // audit log (Ø¨Ø³ÙŠØ·)
    function audit(action, id, meta){
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEY + '_log') || '[]');
      logs.unshift({ t: Date.now(), action, id, meta: meta || null });
      localStorage.setItem(STORAGE_KEY + '_log', JSON.stringify(logs));
      console.log('AUDIT', action, id, meta || '');
    }

    // init
    if (!localStorage.getItem(STORAGE_KEY)) {
      // erster start: demo Ø¨ÙŠØ§Ù†Ø§Øª
      fillDemo();
    } else {
      load();
    }
  </script>
</body>
</html>
 
    
